# Цифро-аналоговый преобразователь CS43L22

## Описание конфигурации проекта
Тактирование от внешнего генератора 8 МГц.
Системные клоки получаются через PLL и составляют 168 МГц.
Все шины тактируются максимальной для них частотой.
I2S тактируется PLLI2SCLK частотой 96 МГц.

Схема подключения:

![Image alt](https://github.com/nekida/stm32f4-discovery/blob/master/cs43l22/pic/schematic.jpg)

Настройка I2C:

![Image alt](https://github.com/nekida/stm32f4-discovery/blob/master/cs43l22/pic/I2C_config.jpg)

Настройка I2S:

![Image alt](https://github.com/nekida/stm32f4-discovery/blob/master/cs43l22/pic/I2S_config.jpg)

Настройка ЦАП производится путем записи значений в регистры по интерфейсу I2C. Данные управления выходным аналоговым сигналом передаются по I2S.

## Описание ЦАП и основное из datasheet'a

## Описание библиотеки

## Описание примеров
### audio_example.c

Этот пример воспроизводит 7 нот первой октавы. Для прослушивания потребуются наушники или колонки. Для работы потребуются файлы: notes.с и notes.h с функциями настройки таймера для каждой ноты.


Для работы этого примера потребуется включить таймер TIM1:

![Image alt](https://github.com/nekida/stm32f4-discovery/blob/master/cs43l22/pic/TIM1_config.jpg)

Настраивая его на прерывания с разной частотой получаем меандр разной частоты. Настраивая таймер метотодом подбора так, чтобы добиться определенной частоты, соответсвующей определенной ноте. Настройка каждого значения нот происходит в функции. Был создан массив таких функций, находящийся в начале файла примера. Время, которое звучит каждая нота, определяется переменной counter_note, которая инициализируется значением на единицу меньшим, чем значение, совпадение с которым приведет к смене ноты. Это сделано для того, чтобы при первом проходе попасть на нулевой элемент массива функций, где находится функция для ноты До.
Функция tim2_switch_val(), в которой происходит инвертирование флага значения данных для отправки по I2S, вызывается в обработчике прерывания таймера TIM1_UP_TIM10_IRQHandler().

### signal_example.c

Этот пример генерирует синусоиду на выходе определенной частоты. Потребуется осциллограф. Для работы потребуются файлы: analog_signals.с и analog_signals.h с функциями создания синусоиды и посылкой ее параметров по I2S.

Вызываете функцию analog_signal_create() с аргументом значения частоты (примерно, от 10 Гц до 20 кГц), в бесконечном цикле вызываете функцию analog_signal_generate(). 
